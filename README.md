ZnJvbSByZXF1ZXN0cyBpbXBvcnQgcG9zdCwgZ2V0CmZyb20gdGhyZWFkaW5nIGltcG9ydCBUaHJlYWQKaW1wb3J0IGN0eXBlcwppbXBvcnQgb3MKaW1wb3J0IHNvY2tldAppbXBvcnQgY29sb3JhbWEKaW1wb3J0IHV1aWQKRm9yZSA9IGNvbG9yYW1hLkZvcmU7Y29sb3JhbWEuaW5pdChhdXRvcmVzZXQ9VHJ1ZSkKTWVzc2FnZUJveCA9IGN0eXBlcy53aW5kbGwudXNlcjMyLk1lc3NhZ2VCb3hXCnRyeToKCVNldHRpbmdzID0gb3BlbignU2V0dGluZ3MudHh0JywgJ3InLCBlbmNvZGluZz0idXRmLTgiKS5yZWFkKCkKZXhjZXB0OgoJd2l0aCBvcGVuKCJTZXR0aW5ncy50eHQiLCAiYSIpIGFzIHg6CgkJTmFtZUFkbWluID0gaW5wdXQoJ1stXSBBZG1pbiBOYW1lIDogJykKCQlOYW1lID0gaW5wdXQoJ1stXSBOYW1lIDogJykKCQlNc2cgPSBpbnB1dCgnWy1dIE1zZyBBbmQgW0BdIDogJykKCQlCaW8gPSBpbnB1dCgnWy1dIEJpbyA6ICcpCgkJeC53cml0ZSgiWy1dIEFkbWluIE5hbWUgOiAiICsgTmFtZUFkbWluICsgIlxuWy1dIE5hbWUgOiAiICsgTmFtZSArICJcblstXSBNc2cgOiAiICsgTXNnICsgIlxuWy1dIEJpbyA6ICIgKyBCaW8pCglTZXR0aW5ncyA9IG9wZW4oJ1NldHRpbmdzLnR4dCcsICdyJywgZW5jb2Rpbmc9InV0Zi04IikucmVhZCgpCnRyeToKCUggPSBTZXR0aW5ncy5zcGxpdCgiXG4iKVswXQoJTmFtZUFkbWluID0gSC5zcGxpdCgnWy1dIEFkbWluIE5hbWUgOiAnKVsxXQoJSCA9IFNldHRpbmdzLnNwbGl0KCJcbiIpWzFdCglOYW1lID0gSC5zcGxpdCgnWy1dIE5hbWUgOiAnKVsxXQoJSCA9IFNldHRpbmdzLnNwbGl0KCJcbiIpWzJdCglNc2cgPSBILnNwbGl0KCdbLV0gTXNnIDogJylbMV0KCUggPSBTZXR0aW5ncy5zcGxpdCgiXG4iKVszXQoJQmlvID0gSC5zcGxpdCgnWy1dIEJpbyA6ICcpWzFdCmV4Y2VwdDoKCXByaW50KCJ7Rm9yZS5SRUR9WyAiICsgRm9yZS5XSElURSArICIvIiArIEZvcmUuUkVEICsgIiBdIE9wZW4gRmlsZSAmIENoZWNrIEZpbGUiKTtpbnB1dCgpCglleGl0KCkKUGFzdGVTYWhlID0gZ2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc2FoZWJyaW5lLy1TYWhlLnB5L21haW4vUkVBRE1FLm1kIikudGV4dAp0cnk6CglIID0gUGFzdGVTYWhlLnNwbGl0KE5hbWVBZG1pbilbMV0KCUggPSBILnNwbGl0KCdEaXNjb3JkIDogJylbMV0KCURpc0hleCA9IEguc3BsaXQoJ1Bhc3RlYmluIDogJylbMF0KCUggPSBILnNwbGl0KCdQYXN0ZWJpbiA6ICcpWzFdCglQYXN0ZUhleCA9IEguc3BsaXQoTmFtZUFkbWluKVswXQpleGNlcHQ6CglwcmludCgie0ZvcmUuUkVEfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBGb3JlLlJFRCArICIgXSBIaT8\/PyBZb3VyIEFkbWluPz8\/IFBsZWFzZSBDb25uZWN0IFNrb3AgQHZudHEgb3IgQHZudHEub2xkIik7aW5wdXQoKQoJZXhpdCgpCkJhbm5lciA9IGdldCgiaHR0cDovL2FydGlpLmhlcm9rdWFwcC5jb20vbWFrZT90ZXh0PSIgKyBOYW1lKS50ZXh0Cm9zLnN5c3RlbSgnY2xzJykKQSA9IDA7IFIgPSAwOyBUID0gMApzID0gc29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCwgc29ja2V0LlNPQ0tfREdSQU0pCnMuY29ubmVjdCgoJ2dvb2dsZS5jb20nLCA4MCkpCmlQID0gcy5nZXRzb2NrbmFtZSgpWzBdClBhc3RlU2FoZSA9IGdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3NhaGVicmluZS8tU2FoZS5weS9tYWluL1JFQURNRS5tZCIpLnRleHQKZGVmIENvbkhleChIZXhpTnQpOgoJcmV0dXJuIGNocihpbnQoSGV4aU50LCAxNikpCkhleFN0ciA9IFBhc3RlSGV4ClN0clNyYyA9ICIiCmlmIGxlbihIZXhTdHIuc3RyaXAoKSkgJSAyID09IDA6Cglmb3IgaSBpbiByYW5nZSAoMCxsZW4oSGV4U3RyLnN0cmlwKCkpLDIpOgoJCVN0ck51bUhleCA9IEhleFN0ci5zdHJpcCgpW2ldICsgSGV4U3RyLnN0cmlwKClbaSsxXQoJCVN0clNyYyArPSBDb25IZXgoU3RyTnVtSGV4KQpQYXN0ZUJpbiA9IFN0clNyYwpkZWYgQ29uSGV4KEhleGlOdCk6CglyZXR1cm4gY2hyKGludChIZXhpTnQsIDE2KSkKSGV4U3RyID0gRGlzSGV4ClN0clNyYyA9ICIiCmlmIGxlbihIZXhTdHIuc3RyaXAoKSkgJSAyID09IDA6Cglmb3IgaSBpbiByYW5nZSAoMCxsZW4oSGV4U3RyLnN0cmlwKCkpLDIpOgoJCVN0ck51bUhleCA9IEhleFN0ci5zdHJpcCgpW2ldICsgSGV4U3RyLnN0cmlwKClbaSsxXQoJCVN0clNyYyArPSBDb25IZXgoU3RyTnVtSGV4KQpEaXNjb3JkID0gU3RyU3JjCmlmIERpc0hleCBpbiBQYXN0ZVNhaGUgYW5kIFBhc3RlSGV4IGluIFBhc3RlU2FoZToKCVBhc3RlQWRtaW4gPSBnZXQoUGFzdGVCaW4pLnRleHQKCWlmIG5vdCBpUCBpbiBQYXN0ZUFkbWluOgoJCXByaW50KGYie0ZvcmUuUkVEfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBGb3JlLlJFRCArIGYiIF0gWW91ciBpUCB7aVB9ICwgRW50ZXIgVG8gRXhpdCIpO2lucHV0KCkKCQlleGl0KCkKTSA9IGludChpbnB1dCgiWyAvIF0gMSA6IFJlZFxuWyAvIF0gMiA6IFNpbHZlclxuWyAvIF0gMyA6IEdyZWVuXG5bIC8gXSA0IDogWWVsbG93XG5bIC8gXSA1IDogQ3lhblxuWyAvIF0gNiA6IE1hZ2VudGFcblsgLyBdIE51bWJlciA6ICIpKQppZiBNID09IDE6CglDb2xvciA9IEZvcmUuUkVECmVsaWYgTSA9PSAyOgoJQ29sb3IgPSBGb3JlLkxJR0hUQkxBQ0tfRVgKZWxpZiBNID09IDM6CglDb2xvciA9IEZvcmUuR1JFRU4KZWxpZiBNID09IDQ6CglDb2xvciA9IEZvcmUuWUVMTE9XCmVsaWYgTSA9PSA1OgoJQ29sb3IgPSBGb3JlLkNZQU4KZWxpZiBNID09IDY6CglDb2xvciA9IEZvcmUuTUFHRU5UQQpvcy5zeXN0ZW0oJ2NscycpCnByaW50KENvbG9yICsgQmFubmVyKQpvcy5zeXN0ZW0oZid0aXRsZToge05hbWV9JykKZGVmIFNlbmREaWMoKToKCWlmIGxlbihUcikgPCA1OgoJCUkgPSBwb3N0KERpc2NvcmQsIGpzb249eyJjb250ZW50IjogIiIsImVtYmVkcyI6W3sidGl0bGUiOiAiTmV3IFN3YXAiLCJkZXNjcmlwdGlvbiI6IGYiVXNlciA6IEB7VHJ9XG5CeSA6IHtOYW1lfVxuKipodHRwczovL2luc3RhZ3JhbS5jb20ve1RyfS8qKiIsInVybCI6ICIiLCJjb2xvciI6ICIxNTkzNzc5MyIsImltYWdlIjogeyJ1cmwiOiAiaHR0cHM6Ly9naWZmaWxlcy5hbHBoYWNvZGVycy5jb20vMTMyLzEzMjY3LmdpZiJ9fV0sInVzZXJuYW1lIjogTmFtZSwiYXZhdGFyX3VybCI6ICJodHRwczovL2IudG9wNHRvcC5pby9wXzIxNDZ5ejRqaTAuanBlZyJ9LCBoZWFkZXJzPXsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifSkudGV4dApkZWYgU3dhcCgpOgoJZ2xvYmFsIEEsIFIsIFQKCXdoaWxlIDE6CgkJdHJ5OgoJCQlSZXEgPSBwb3N0KCJodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjEvYWNjb3VudHMvc2V0X3VzZXJuYW1lLyIsIGRhdGE9eyJ1c2VybmFtZSI6VHJ9LCBoZWFkZXJzPXsiVXNlci1BZ2VudCI6Ikluc3RhZ3JhbSAxMjMuMS4wLjI2LjExNCAoaVBob25lWFIpIiwiQ29udGVudC1UeXBlIjoiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04In0sIGNvb2tpZXM9Q29va2llcykuc3RhdHVzX2NvZGUKCQkJaWYgUmVxID09IDIwMDoKCQkJCWlmIFIgPT0gMDoKCQkJCQlSID0gMQoJCQkJCWlmIEEgPT0gMDoKCQkJCQkJcHJpbnQoZiJ7Q29sb3J9WyAiICsgRm9yZS5XSElURSArICIvIiArIENvbG9yICsgZiIgXSB7TXNnfXtUcn0iKQoJCQkJCWVsc2U6CgkJCQkJCXByaW50KGYiXG57Q29sb3J9WyAiICsgRm9yZS5XSElURSArICIvIiArIENvbG9yICsgZiIgXSB7TXNnfXtUcn0iKQoJCQkJCVNlbmREaWMoKQoJCQkJCU1lc3NhZ2VCb3goTm9uZSwgZid7TXNnfXtUcn0nLCBOYW1lLCAwKQoJCQllbGlmIFJlcSA9PSA0Mjk6CgkJCQlpZiBSID09IDA6CgkJCQkJVCArPSAxCgkJCQkJaWYgVCA9PSAxMDoKCQkJCQkJcHJpbnQoZiJcbntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyBmIiBdIFlvdXIgQWNjb3VudCBpcyBTcGFtLCBFbnRlciBUbyBFeGl0IikKCQkJZWxpZiBSZXEgPT0gNDAwOgoJCQkJaWYgUiA9PSAwOgoJCQkJCUEgKz0gMQoJCQkJCXByaW50KGYiXHJbIC8gXSBBdHRlbXB0cyA6IHtBfSIsIGVuZD0iIikKCQkJUmVxID0gcG9zdCgiaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS9hY2NvdW50cy9lZGl0LyIsIGRhdGE9eyJmaXJzdF9uYW1lIjpOLCJlbWFpbCI6RW1haWwsInVzZXJuYW1lIjpUciwicGhvbmVfbnVtYmVyIjpQaG9uZSwiYmlvZ3JhcGh5IjpCaW8sImV4dGVybmFsX3VybCI6IiIsImNoYWluaW5nX2VuYWJsZWQiOiJvbiJ9LCBoZWFkZXJzPXsiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjEpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84NC4wLjQxNDcuMTM1IFNhZmFyaS81MzcuMzYiLCJ4LWNzcmZ0b2tlbiI6IENvb2tpZXNbImNzcmZ0b2tlbiJdLCJ4LWlnLWFwcC1pZCI6ICI5MzY2MTk3NDMzOTI0NTkiLCJ4LWluc3RhZ3JhbS1hamF4IjogIjBjMTVmNGQ3ZDQ0YSIsIngtcmVxdWVzdGVkLXdpdGgiOiAiWE1MSHR0cFJlcXVlc3QifSwgY29va2llcz1Db29raWVzKS5zdGF0dXNfY29kZQoJCQlpZiBSZXEgPT0gMjAwOgoJCQkJaWYgUiA9PSAwOgoJCQkJCVIgPSAxCgkJCQkJaWYgQSA9PSAwOgoJCQkJCQlwcmludChmIntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyBmIiBdIHtNc2d9e1RyfSIpCgkJCQkJZWxzZToKCQkJCQkJcHJpbnQoZiJcbntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyBmIiBdIHtNc2d9e1RyfSIpCgkJCQkJU2VuZERpYygpCgkJCQkJTWVzc2FnZUJveChOb25lLCBmJ3tNc2d9e1RyfScsIE5hbWUsIDApCgkJCWVsaWYgUmVxID09IDQyOToKCQkJCWlmIFIgPT0gMDoKCQkJCQlUICs9IDEKCQkJCQlpZiBUID09IDEwOgoJCQkJCQlwcmludChmIlxue0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gWW91ciBBY2NvdW50IGlzIFNwYW0sIEVudGVyIFRvIEV4aXQiKQoJCQllbGlmIFJlcSA9PSA0MDA6CgkJCQlpZiBSID09IDA6CgkJCQkJQSArPSAxCgkJCQkJcHJpbnQoZiJcclsgLyBdIEF0dGVtcHRzIDoge0F9IiwgZW5kPSIiKQoJCWV4Y2VwdDoKCQkJSEkgPSAwClVzID0gaW5wdXQoIlsgLyBdIFVzZXIgOiAiKQpQYSA9IGlucHV0KCJbIC8gXSBQYXNzIDogIikKVHIgPSBpbnB1dCgiWyAvIF0gVGFyZ2V0IDogIikKVGhyID0gaW50KGlucHV0KCJbIC8gXSBUaHJlYWQgOiAiKSkKb3Muc3lzdGVtKCJjbHMiKQpwcmludChDb2xvciArIEJhbm5lcikKcHJpbnQoZiJ7Q29sb3J9WyAiICsgRm9yZS5XSElURSArICIvIiArIENvbG9yICsgZiIgXSBVc2VyIDoge1VzfVxue0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gUGFzcyA6IEhvdyBBcmUgWW91P1xue0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gVGFyZ2V0IDoge1RyfVxue0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gVGhyZWFkIDoge1Rocn0iKQpSZXEgPSBwb3N0KCJodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjEvYWNjb3VudHMvbG9naW4vIiwgZGF0YT17InBhc3N3b3JkIjpQYSwidXNlcm5hbWUiOlVzLCJkZXZpY2VfaWQiOnV1aWQudXVpZDQoKX0sIGhlYWRlcnM9eyJVc2VyLUFnZW50IjoiSW5zdGFncmFtIDEyMy4xLjAuMjYuMTE0IChpUGhvbmVYUikiLCJDb250ZW50LVR5cGUiOiJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgifSkKaWYgImxvZ2dlZF9pbl91c2VyIiBpbiBSZXEudGV4dDoKCUNvb2tpZXMgPSBSZXEuY29va2llcwoJUmVxID0gcG9zdCgiaHR0cHM6Ly9pLmluc3RhZ3JhbS5jb20vYXBpL3YxL2FjY291bnRzL3NldF91c2VybmFtZS8iLCBkYXRhPXsidXNlcm5hbWUiOiJzYWhlIn0sIGhlYWRlcnM9eyJVc2VyLUFnZW50IjoiSW5zdGFncmFtIDEyMy4xLjAuMjYuMTE0IChpUGhvbmVYUikiLCJDb250ZW50LVR5cGUiOiJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgifSwgY29va2llcz1Db29raWVzKQoJaWYgUmVxLnN0YXR1c19jb2RlID09IDQwMDoKCQlwcmludChmIntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyBmIiBdIFNlY2Nlc3NmdWxseSBMb2dpbiIpCgkJUmVxID0gZ2V0KCJodHRwczovL3d3dy5pbnN0YWdyYW0uY29tL2FjY291bnRzL2VkaXQvP19fYT0xIiwgaGVhZGVycz17IlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODQuMC40MTQ3LjEzNSBTYWZhcmkvNTM3LjM2IiwieC1jc3JmdG9rZW4iOiBDb29raWVzWyJjc3JmdG9rZW4iXSwieC1pZy1hcHAtaWQiOiAiOTM2NjE5NzQzMzkyNDU5IiwieC1pbnN0YWdyYW0tYWpheCI6ICIwYzE1ZjRkN2Q0NGEiLCJ4LXJlcXVlc3RlZC13aXRoIjogIlhNTEh0dHBSZXF1ZXN0In0sIGNvb2tpZXM9Q29va2llcywgdGltZW91dD0zKS5qc29uKCkKCQl0cnk6CgkJCU4gPSBSZXFbImZvcm1fZGF0YSJdWyJmaXJzdF9uYW1lIl0KCQlleGNlcHQ6CgkJCU4gPSAiIgoJCXRyeToKCQkJRW1haWwgPSBSZXFbImZvcm1fZGF0YSJdWyJlbWFpbCJdCgkJZXhjZXB0OgoJCQlFbWFpbCA9ICIiCgkJdHJ5OgoJCQlQaG9uZSA9IFJlcVsiZm9ybV9kYXRhIl1bInBob25lX251bWJlciJdCgkJZXhjZXB0OgoJCQlQaG9uZSA9ICIiCgkJTWVzc2FnZUJveChOb25lLCBmJ0VudGVyIFsgT2sgXSBUbyBSZWFkeScsIE5hbWUsIDApCgkJZm9yIGkgaW4gcmFuZ2UoVGhyICogMTAwKToKCQkJVCA9IFRocmVhZCh0YXJnZXQ9U3dhcCkuc3RhcnQoKQoJZWxpZiBSZXEuc3RhdHVzX2NvZGUgPT0gNDI5OgoJCXByaW50KGYie0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gWW91ciBBY2NvdW50IGlzIFNwYW0sIEVudGVyIFRvIEV4aXQiKTtpbnB1dCgpCgkJZXhpdCgpCgllbHNlOgoJCXByaW50KGYie0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0ge1JlcS50ZXh0fSIpO2lucHV0KCkKCQlleGl0KCkKZWxpZiAiY2hhIiBpbiBSZXEudGV4dDoKCUNvb2tpZXNDaGFsbGFuZ2UgPSBSZXEuY29va2llcwoJUGF0aENoYWxsZW5nZSA9IFJlcS5qc29uKClbJ2NoYWxsZW5nZSddWydhcGlfcGF0aCddCglTZWN1cmUgPSBnZXQoImh0dHBzOi8vaS5pbnN0YWdyYW0uY29tL2FwaS92MSIgKyBQYXRoQ2hhbGxlbmdlLCBoZWFkZXJzPXsiVXNlci1BZ2VudCI6Ikluc3RhZ3JhbSAxMjMuMS4wLjI2LjExNCAoaVBob25lWFIpIiwiQ29udGVudC1UeXBlIjoiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04In0sIGNvb2tpZXM9Q29va2llc0NoYWxsYW5nZSkuanNvbigpCgl0cnk6CgkJRW1haWwgPSBTZWN1cmVbJ3N0ZXBfZGF0YSddWydlbWFpbCddCglleGNlcHQ6CgkJRW1haWwgPSAiIgoJdHJ5OgoJCVBob25lID0gU2VjdXJlWydzdGVwX2RhdGEnXVsncGhvbmVfbnVtYmVyJ10KCWV4Y2VwdDoKCQlQaG9uZSA9ICIiCglpZiBub3QgRW1haWwgPT0gIiIgYW5kIG5vdCBQaG9uZSA9PSAiIjoKCQlwcmludChmIntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyAiIF0gMSA6ICIgKyBQaG9uZSkKCQlwcmludChmIntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyAiIF0gMiA6ICIgKyBFbWFpbCkKCQlNb2RlID0gaW50KGlucHV0KCJbIC8gXSBFbnRlciBOdW1iZXIgOiAiKSkgLSAxCgllbGlmIFBob25lID09ICIiIGFuZCBFbWFpbCA9PSAiIjoKCQlwcmludChmIntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyAiIF0gU2VjdXJlIFVuS25vd3MsIEVudGVyIFRvIEV4aXQiKQoJCWlucHV0KCkKCQlleGl0KCkKCWVsc2U6CgkJaWYgbm90IEVtYWlsID09ICIiOgoJCQlwcmludChmIntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyAiIF0gMSA6ICIgKyBFbWFpbCkKCQkJTW9kZSA9IGludChpbnB1dCgiWyAvIF0gRW50ZXIgTnVtYmVyIDogIikpCgkJaWYgbm90IFBob25lID09ICIiOgoJCQlwcmludChmIntDb2xvcn1bICIgKyBGb3JlLldISVRFICsgIi8iICsgQ29sb3IgKyAiIF0gMSA6ICIgKyBQaG9uZSkKCQkJTW9kZSA9IGludChpbnB1dCgiWyAvIF0gRW50ZXIgTnVtYmVyIDogIikpIC0gMQoJU2VuZENvZGUgPSBwb3N0KCJodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjEiICsgUGF0aENoYWxsZW5nZSwgaGVhZGVycz17IlVzZXItQWdlbnQiOiJJbnN0YWdyYW0gMTIzLjEuMC4yNi4xMTQgKGlQaG9uZVhSKSIsIkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCJ9LCBkYXRhPXsiY2hvaWNlIjpNb2RlfSwgY29va2llcz1Db29raWVzQ2hhbGxhbmdlKS5qc29uKCkKCUNvbnRhY3QgPSBTZW5kQ29kZVsnc3RlcF9kYXRhJ11bJ2NvbnRhY3RfcG9pbnQnXQoJcHJpbnQoZiJ7Q29sb3J9WyAiICsgRm9yZS5XSElURSArICIvIiArIENvbG9yICsgZiIgXSBTZWNjZXNzZnVsbHkgU2VuZCBUbyB7Q29udGFjdH0iKQoJQ29kZSA9IGlucHV0KCdbIC8gXSBFbnRlciBZb3VyIENvZGUgOiAnKQoJQ29uZmlybUNvZGUgPSBwb3N0KCJodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjEiICsgUGF0aENoYWxsZW5nZSwgaGVhZGVycz17IlVzZXItQWdlbnQiOiJJbnN0YWdyYW0gMTIzLjEuMC4yNi4xMTQgKGlQaG9uZVhSKSIsIkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCJ9LCBkYXRhPXsic2VjdXJpdHlfY29kZSI6Q29kZX0sIGNvb2tpZXM9Q29va2llc0NoYWxsYW5nZSkKCW9zLnN5c3RlbSgiY2xzIikKCXByaW50KENvbG9yICsgQmFubmVyKQoJcHJpbnQoZiJ7Q29sb3J9WyAiICsgRm9yZS5XSElURSArICIvIiArIENvbG9yICsgZiIgXSBVc2VyIDoge1VzfVxue0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gUGFzcyA6IEhvdyBBcmUgWW91P1xue0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gVGFyZ2V0IDoge1RyfVxue0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gVGhyZWFkIDoge1Rocn0iKQoJaWYgImxvZ2dlZF9pbl91c2VyIiBpbiBDb25maXJtQ29kZS50ZXh0OgoJCXByaW50KGYie0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gU2VjY2Vzc2Z1bGx5IExvZ2luIikKCQlDb29raWVzID0gQ29uZmlybUNvZGUuY29va2llcwoJCVJlcSA9IHBvc3QoImh0dHBzOi8vaS5pbnN0YWdyYW0uY29tL2FwaS92MS9hY2NvdW50cy9zZXRfdXNlcm5hbWUvIiwgZGF0YT17InVzZXJuYW1lIjoic2FoZSJ9LCBoZWFkZXJzPXsiVXNlci1BZ2VudCI6Ikluc3RhZ3JhbSAxMjMuMS4wLjI2LjExNCAoaVBob25lWFIpIiwiQ29udGVudC1UeXBlIjoiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04In0sIGNvb2tpZXM9Q29va2llcykKCQlpZiBSZXEuc3RhdHVzX2NvZGUgPT0gNDAwOgoJCQlSZXEgPSBnZXQoImh0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vYWNjb3VudHMvZWRpdC8\/X19hPTEiLCBoZWFkZXJzPXsiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjEpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84NC4wLjQxNDcuMTM1IFNhZmFyaS81MzcuMzYiLCJ4LWNzcmZ0b2tlbiI6IENvb2tpZXNbImNzcmZ0b2tlbiJdLCJ4LWlnLWFwcC1pZCI6ICI5MzY2MTk3NDMzOTI0NTkiLCJ4LWluc3RhZ3JhbS1hamF4IjogIjBjMTVmNGQ3ZDQ0YSIsIngtcmVxdWVzdGVkLXdpdGgiOiAiWE1MSHR0cFJlcXVlc3QifSwgY29va2llcz1Db29raWVzLCB0aW1lb3V0PTMpLmpzb24oKQoJCQl0cnk6CgkJCQlOID0gUmVxWyJmb3JtX2RhdGEiXVsiZmlyc3RfbmFtZSJdCgkJCWV4Y2VwdDoKCQkJCU4gPSAiIgoJCQl0cnk6CgkJCQlFbWFpbCA9IFJlcVsiZm9ybV9kYXRhIl1bImVtYWlsIl0KCQkJZXhjZXB0OgoJCQkJRW1haWwgPSAiIgoJCQl0cnk6CgkJCQlQaG9uZSA9IFJlcVsiZm9ybV9kYXRhIl1bInBob25lX251bWJlciJdCgkJCWV4Y2VwdDoKCQkJCVBob25lID0gIiIKCQkJcHJpbnQoZiJ7Q29sb3J9WyAiICsgRm9yZS5XSElURSArICIvIiArIENvbG9yICsgZiIgXSBTZWNjZXNzZnVsbHkgTG9naW4iKQoJCQlNZXNzYWdlQm94KE5vbmUsIGYnRW50ZXIgWyBPayBdIFRvIFJlYWR5JywgTmFtZSwgMCkKCQkJZm9yIGkgaW4gcmFuZ2UoVGhyICogMTAwKToKCQkJCVQgPSBUaHJlYWQodGFyZ2V0PVN3YXApLnN0YXJ0KCkKCQllbGlmIFJlcS5zdGF0dXNfY29kZSA9PSA0Mjk6CgkJCXByaW50KGYie0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0gWW91ciBBY2NvdW50IGlzIFNwYW0sIEVudGVyIFRvIEV4aXQiKQoJCQlpbnB1dCgpCgkJCWV4aXQoKQoJCWVsc2U6CgkJCXByaW50KGYie0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0ge1JlcS50ZXh0fSIpO2lucHV0KCkKCQkJZXhpdCgpCgllbHNlOgoJCXByaW50KGYie0NvbG9yfVsgIiArIEZvcmUuV0hJVEUgKyAiLyIgKyBDb2xvciArIGYiIF0ge0NvbmZpcm1Db2RlLnRleHR9Iik7aW5wdXQoKQoJCWV4aXQoKQplbHNlOgoJcHJpbnQoZiJ7Q29sb3J9WyAiICsgRm9yZS5XSElURSArICIvIiArIENvbG9yICsgZiIgXSB7UmVxLnRleHR9Iik7aW5wdXQoKQoJZXhpdCgpCg==
